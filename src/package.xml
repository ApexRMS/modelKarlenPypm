<?xml version="1.0" encoding="utf-8"?>
<package name="modelKarlenPypm" displayName="Add-On to the Epidemic Package for the Karlen model" isAddOn="True" extendsPackage="epi" version="1.0.0">
  <transformers>
    <transformer
      name="modelKarlenPypm_fetchModels"
      isPrimary="True"
      displayName="modelKarlenPypm_fetchModels"
      programName="spyder"
      programArguments="fetchModels.py"
      extendsTransformer="epi_Primary"
      runContext="LocalOnly"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="ModelsAvailable" displayName="Models Available" dataScope="Scenario">
          <datasheets>
            <datasheet name="ModelsAvailable" displayname="Models Available">
              <columns>
                <column name="ModelsAvailableID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Region" dataType="String" displayName="Region Name"/>
                <column name="Name" dataType="String" displayName="Model Name"/>
                <!-- <column name="Description" dataType="String" displayName="Description"/> -->
                <column name="URL" dataType="String" displayName="Model Download URL"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="ModelsAvailable" type="Output"/>
      </pipeline>
      <include>
        <transformer name="modelKarlenPypm_fetchParameters"/>
        <transformer name="modelKarlenPypm_runIterations"/>
      </include>
    </transformer>
    <transformer
      name="modelKarlenPypm_fetchParameters"
      displayName="modelKarlenPypm_fetchParameters"
      programName="spyder"
      programArguments="defaultParameters.py"
      extendsTransformer="epi_Primary"
      runContext="LocalOnly"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="ParameterValues" displayName="Parameter Values" dataScope="Scenario">
          <datasheets>
            <datasheet name="ParameterValues" displayname="Parameter Values">
              <columns>
                <column name="ParameterValuesID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Name" dataType="String" displayName="Parameter Name"/>
                <column name="Description" dataType="String" displayName="Description"/>
                <!-- validationType="List" formula1="\'int\':Int|\'float\':Float" -->
                <column name="Type" dataType="String"  displayName="Variable Type"/>
                <column name="Initial" dataType="Double" displayName="Initial Value"/>
                <column name="Min" dataType="Double" displayName="Minimum Value"/>
                <column name="Max" dataType="Double" displayName="Maximum Value"/>
                <!-- validationType="List" formula1="fixed|variable" -->
                <column name="Status" dataType="String"  displayName="Fixed/Variable (for fitting)"/>
                <!-- get a validation for this too -->
                <column name="PriorDist" dataType="String" displayName="Prior Distribution"/>
                <column name="PriorMean" dataType="Double" displayName="Prior Mean"/>
                <column name="PriorSecond" dataType="Double" displayName="Prior SD/Half-width"/>
                <column name="MCMCStep" dataType="Double" displayName="MCMC step size"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="ModelFile" displayName="Downloadeded Model" dataScope="Scenario">
          <datasheets>
            <datasheet name="ModelFile" displayName="Downloaded Model" isSingeRow="True">
              <columns>
                <column name="ModelFileID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Region" dataType="String" displayName="Region"/>
                <column name="Name" dataType="String" displayName="Name"/>
                <column name="URL" dataType="String" displayName="URL"/>
                <column name="PypmFile" displayName="Object File" dataType="String" isExternalFile="True"/>
                <column name="DateTime" dataType="String" displayName="Download Date/Time"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="ParameterValues" type="Output"/>
        <datafeed name="ModelFile" type="Output"/>
        <datafeed name="epi_RunControl" type="Input"/>
      </pipeline>
    </transformer>
    <transformer
      name="modelKarlenPypm_runIterations"
      displayName="modelKarlenPypm_runIterations"
      programName="spyder"
      programArguments="runIterations.py"
      extendsTransformer="epi_Primary"
      runContext="LocalOnly"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="FittingParams" displayName="Fitting Parameters" dataScope="Scenario">
          <datasheets>
            <datasheet name="FittingParams" displayName="Fitting Parameters" isSingleRow="True">
              <columns>
                <column name="FittingParamsID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="DaysToFit" dataType="String" displayName="Days to Fit"/>
                <column name="CumulReset" dataType="Integer" valdationType="List" formula1="1:True|0:False"/>
                <column name="SkipDatesText" dataType="String" displayName="Days to Skip"/>
              </columns>
              <defaultRecords>
                <record columns="DaysToFit|CumulReset|SkipDatesText" values="37:350|1|25,45:47"/>
              </defaultRecords>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="CompleteData" displayName="Simulation Data" dataScope="Scenario">
          <datasheets>
            <datasheet name="CompleteData" displayName="Simulation Data">
              <columns>
                <column name="CompleteDataID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Iteration" dataType="Integer" displayName="Iteration"/>
                <column name="Timestep" dataType="Date" displayName="Timestep"/>
                <column name="DailyInfected" dataType="Integer" displayName="number of people infected daily"/>
                <column name="Susceptible" dataType="Integer" displayName="number of people who could become infected"/>
                <column name="Contagious" dataType="Integer" displayName="number of people that can cause someone to become infected"/>
                <column name="Total" dataType="Integer" displayName="total population of the region"/>
                <column name="Infected" dataType="Integer" displayName="total number of people ever infected"/>
                <column name="VaccCand" dataType="Integer" displayName="vaccination candidates"/>
                <column name="DailyVaccinated" dataType="Integer" displayName="number of people vaccinated each day"/>
                <column name="Vaccinated" dataType="Integer" displayName="people vaccinated"/>
                <column name="UsefullyVaccinated" dataType="Integer" displayName="people who were vaccinated when susceptible"/>
                <column name="Immunized" dataType="Integer" displayName="number of susceptible people who were immunized by vaccine"/>
                <column name="Recovered" dataType="Integer" displayName="People who have recovered from the illness and are therefore no longer susceptible"/>
                <column name="Deaths" dataType="Integer" displayName="people who have died from the illness"/>
                <column name="ContactTraced" dataType="Integer" displayName="People identified through contact tracing"/>
                <column name="Symptomatic" dataType="Integer" displayName="People who have shown symptoms"/>
                <column name="AsymptomaticRecovered" dataType="Integer" displayName="People who have not shown symptoms"/>
                <column name="Removed" dataType="Integer" displayName="People removed from the contagious population"/>
                <column name="Positives" dataType="Integer" displayName="People who received a positive test report"/>
                <column name="Reported" dataType="Integer" displayName="Positives and reporting anomalies"/>
                <!-- <column name="ReportAnomalies" dataType="Integer" displayName="Represents anomalous batches of reports"/> -->
                <column name="NonIcuHospitalized" dataType="Integer" displayName="Total non_icu hospitalization cases"/>
                <column name="NonIcuRel" dataType="Integer" displayName="Hospitalized not needing ICU and released"/>
                <column name="IcuAdmissions" dataType="Integer" displayName="People admitted to ICU"/>
                <column name="Ventilated" dataType="Integer" displayName="People who received ICU ventilator"/>
                <column name="NonVentilatedRel" dataType="Integer" displayName="ICU non-vent released"/>
                <column name="VentilatedRel" dataType="Integer" displayName="ICU ventilated released"/>
                <column name="Hospitalized" dataType="Integer" displayName="Total hospitalization cases"/>
                <column name="InHospital" dataType="Integer" displayName="People currently in hospital"/>
                <column name="InIcu" dataType="Integer" displayName="People currently in ICU"/>
                <column name="OnVentilator" dataType="Integer" displayName="People currently on ICU ventilator"/>
                <column name="SusVaccCand" dataType="Integer" displayName="vaccination candidates who are susceptible"/>
                <!-- <column name="Frac" dataType="Integer" displayName=""/> -->
                <!-- <column name="Outbreaks" dataType="Integer" displayName="Infection outbreaks"/> -->
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="ParameterValues" type="Input"/>
        <datafeed name="ModelFile" type="Input"/>
        <datafeed name="epi_RunControl" type="Input"/>
        <datafeed name="FittingParams" type="Input"/>
        <datafeed name="epi_DataSummary" type="Output"/>
        <datafeed name="CompleteData" type=" Output"/>
      </pipeline>
    </transformer>
  </transformers>
  <layouts>
    <layout name="coreforms_LibraryDatafeeds">
      <item name="core_RConfig"/>
    </layout>
    <layout name="coreforms_ScenarioDatafeeds">
      <item name="ParameterValues" displayName="Parameter Values" appendTo="epi_Sources"/>
      <item name="ModelsAvailable" displayName="Models Available" appendTo="epi_Sources"/>
      <item name="ModelFile" displayName="Downloaded Model" appendTo="epi_Sources"/>
      <item name="FittingParams" displayName="Fitting Parameters" appendTo="epi_Sources"/>
      <item name="CompleteData" displayName="Simulation Data" appendTo="epi_Sources"/>
    </layout>
  </layouts>
</package>
