<?xml version="1.0" encoding="utf-8"?>
<package name="modelKarlenPypm" displayName="Add-On to the Epidemic Package for the Karlen model" isAddOn="True" extendsPackage="epi" version="1.0.0">
  <transformers>
    <transformer
      name="getRepos"
      isPrimary="True"
      displayName="modelKarlenPypm_A_getRepos"
      programName="spyder"
      programArguments="getRepos.py"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="CrosswalkFile" displayName="Population Names" dataScope="Scenario">
          <datasheets>
            <datasheet name="CrosswalkFile" displayName="Population Names File" isSingeRow="True">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="File" displayName="File" dataType="String" isExternalFile="True"/>
                <column name="DateTime" dataType="String" displayName="Download Date/Time"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="PypmcaJuris" displayName="PypmcaJuris" dataScope="Project">
          <datasheets>
            <datasheet name="PypmcaJuris" valueMember="InputID" displayMember="Name">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String"/>
                <column name="URL" dataType="String"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="PypmcaData" displayNAme="PypmcaData" dataScope="Project">
          <datasheets>
            <datasheet name="PypmcaData" valueMember="InputID" displayMember="Name">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String"/>
                <column name="Country" dataType="String"/>
                <column name="Region" dataType="String"/>
                <column name="URL" dataType="String"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="ModelsAvailable" displayName="Models Available" dataScope="Scenario">
          <datasheets>
            <datasheet name="ModelsAvailable" displayname="Models Available">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Country" dataType="String"/>
                <column name="Region" dataType="String"/>
                <column name="Version" dataType="String"/>
                <column name="AgeRange" dataType="String" displayName="Age Range"/>
                <column name="Date" dataType="String"/>
                <column name="Name" dataType="String" isVisible="False"/>
                <column name="Code" dataType="String" isVisible="False"/>
                <column name="URL" dataType="String" isVisible="False"/>
                <column name="LUT" dataType="String" isVisible="False"/>
              </columns>
              <validations>
                <validation validationType="Unique" columns="Code|Country|Region|Name|URL"/>
              </validations>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="DataAvailable" displayName="Data Sets Available" dataScope="Scenario">
          <datasheets>
            <datasheet name="DataAvailable" displayname="Data Sets Available">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Country" dataType="String" displayName="Country"/>
                <column name="Region" dataType="String" displayName="Region"/>
                <column name="AgeStructure" dataType="Boolean" displayName="Age Structure"/>
                <column name="URL" dataType="String" isVisible="False"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="CrosswalkFile"/>
        <datafeed name="ModelsAvailable"/>
        <datafeed name="PypmcaJuris"/>
        <datafeed name="PypmcaData"/>
        <datafeed name="DataAvailable"/>
      </pipeline>
      <include>
        <transformer name="getParameters"/>
        <transformer name="getData"/>
        <transformer name="runIterations"/>
      </include>
    </transformer>
    <transformer
      name="getParameters"
      displayName="modelKarlenPypm_B_getParameters"
      programName="spyder"
      programArguments="defaultParameters.py"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="ParameterValues" displayName="Parameter Values" dataScope="Scenario">
          <datasheets>
            <datasheet name="ParameterValues" displayname="Parameter Values">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Name" dataType="String" displayName="Parameter Name"/>
                <column name="Description" dataType="String" displayName="Description"/>
                <column name="Initial" dataType="Double" displayName="Initial Value"/>
                <column name="Min" dataType="Double" displayName="Minimum Value"/>
                <column name="Max" dataType="Double" displayName="Maximum Value"/>
                <column name="Status" dataType="Integer" validationType="List" formula1="1:fixed|2:variable" displayName="Fixed/Variable"/>
                <column name="PriorDist" dataType="Integer" displayName="Prior Distribution" validationType="List" formula1="1:uniform|2:norm|3:"/>
                <column name="PriorMean" dataType="Double" displayName="Prior Mean"/>
                <column name="PriorSecond" dataType="Double" validationType="Decimal" validationCondition="GreaterEqual" formula1="0.0" displayName="Prior SD/Half-width"/>
                <column name="MCMCStep" dataType="Double" validationType="Decimal" validationCondition="GreaterEqual" formula1="0.0" displayName="MCMC step size"/>
              </columns>
              <validations>
                <validation validationType="Unique" columns="Name|Description"/>
              </validations>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="ModelFile" displayName="Downloaded Model" dataScope="Scenario">
          <datasheets>
            <datasheet name="ModelFile" displayName="Downloaded Model" isSingeRow="True">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Region" dataType="String" displayName="Region"/>
                <column name="Name" dataType="String" displayName="Name"/>
                <column name="URL" dataType="String" displayName="URL"/>
                <column name="PypmFile" displayName="Object File" dataType="String" isExternalFile="True"/>
                <column name="DateTime" dataType="String" displayName="Download Date/Time"/>
              </columns>
              <validations>
                <validation validationType="Unique" columns="Region|Name|URL|PypmFile"/>
              </validations>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="PopulationSelectionTable" displayName="Population Selection" dataScope="Scenario">
          <datasheets>
            <datasheet name="PopulationSelectionTable" displayName="Population Selection">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="Show" dataType="Boolean" displayName="Show (Yes/No)"/>
                <column name="Standard" dataType="String" displayName="Population Name"/>
                <column name="Description" dataType="String"/>
                <column name="Stock" dataType="String"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="ModelChoices" displayName="Model Options" dataScope="Scenario">
          <datasheets>
            <datasheet name="ModelChoices" displayName="Model Options">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="Location" dataType="Integer" validationType="Datasheet" formula1="PypmcaJuris" allowDbNull="False" displayname="Model:"/>
                <column name="FileName" dataType="String" displayName="Crosswalk File:" isExternalFile="True"/>
              </columns>
              <defaultRecords>
                <record columns="FileName" values="C:\Users\User\Documents\GitHub\modelKarlenPypm\StockToStandard.csv"/>
              </defaultRecords>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="ParameterValues"/>
        <datafeed name="ModelFile"/>
        <datafeed name="PopulationSelectionTable"/>
        <datafeed name="ModelChoices"/>
      </pipeline>
    </transformer>
    <transformer
      name="getData"
      displayName="modelKarlenPypm_C_getData"
      programName="spyder"
      programArguments="getData.py"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="DataChoices" displayName="Regions" dataScope="Scenario">
          <datasheets>
            <datasheet name="DataChoices" displayName="Regions">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="DataSet" dataType="Integer" validationType="Datasheet" formula1="PypmcaData" allowDbNull="False" displayName="Data Set:"/>
                <column name="FileName" dataType="String" displayName="Crosswalk File:" isExternalFile="True"/>
              </columns>
              <defaultRecords>
                <record columns="FileName" values="C:\Users\User\Documents\GitHub\modelKarlenPypm\StockToStandard.csv"/>
              </defaultRecords>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="DataFileOut" displayName="Data File" dataScope="Scenario">
          <datasheets>
            <datasheet name="DataFileOut" displayName="Data File" isSingeRow="True">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="File" displayName="File" dataType="String" isExternalFile="True"/>
                <column name="DateTime" dataType="String" displayName="Download Date/Time"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="DataChoices"/>
        <datafeed name="epi_DataSummary"/>
        <datafeed name="DataFileOut"/>
      </pipeline>
    </transformer>
    <transformer
      name="runIterations"
      displayName="modelKarlenPypm_D_runIterations"
      programName="spyder"
      programArguments="runIterations.py"
      isRunnable ="True">
      <datafeeds>
        <datafeed name="FittingParams" displayName="Fitting Parameters" dataScope="Scenario">
          <datasheets>
            <datasheet name="FittingParams" displayName="Fitting Parameters" isSingleRow="True">
              <columns>
                <column name="InputID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" isOptional="True"/>
                <column name="FitVariable" dataType="Integer" validationType="List" formula1="1:Cases - Cumulative|2:Infected - Cumulative|3:Cases - Daily|4:Infected - Daily" displayName="Variable To Fit:"/>
                <column name="StartFit" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" displayName="Day To Start Fitting:"/>
                <column name="EndFit" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" displayName="Day To End Fitting:"/>
                <column name="CumulReset" dataType="Boolean" displayName="Reset Cumulative to Zero:"/>
                <column name="SkipDatesText" dataType="String" displayName="Days to Skip:"/>
                <column name="Iterations" dataType="Integer"/>
                <column name="EndDate" dataType="Date" displayName="End Date"/>
              </columns>
              <defaultRecords>
                <record columns="FitVariable|StartFit|SkipDatesText|Iterations" values="1|37|147,45:47|20"/>
              </defaultRecords>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="FitVariables" displayName="Fit Variables" dataScope="Scenario">
          <datasheets>
            <datasheet name="FitVariables" displayName="Fit Variables">
              <columns>
                <column name="InputsID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="Variable" dataType="String"/>
                <column name="Value" dataType="Double"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      </datafeeds>
      <pipeline>
        <datafeed name="ParameterValues"/>
        <datafeed name="ModelFile"/>
        <datafeed name="PopulationSelectionTable"/>
        <datafeed name="CrosswalkFile"/>
        <datafeed name="FittingParams"/>
        <datafeed name="ModelChoices"/>
        <datafeed name="epi_DataSummary"/>
      </pipeline>
    </transformer>
  </transformers>
  <layouts>
    <layout name="coreforms_ScenarioDatafeeds">
      <group name="Pypmca" displayName="Pypmca" appendTo="epi_Models">
        <group name="Repos" displayName="Repositories" appendTo="Pypmca">
          <item name="ModelsAvailable" itemTransformer="getRepos" showIf="isResult"/>
          <item name="DataAvailable" itemTransformer="getRepos" showIf="isResult"/>
          <item name="CrosswalkFile" itemTransformer="getRepos" showIf="isResult"/>
        </group>
        <group name="Params" displayName="Parameter Choice" appendTo="Pypmca">
          <item name="ModelChoices" itemTransformer="getParameters" showIf="isParent"/>
          <item name="ParameterValues" itemTransformer="getParameters" showIf="isResult"/>
          <item name="ModelFile" itemTransformer="getParameters" showIf="isResult"/>
          <item name="PopulationSelectionTable" itemTransformer="getParameters" showIf="isResult"/>
        </group>
        <group name="Data" displayName="COVID-19 Case Data" appendTo="Pypmca">
          <item name="DataChoices" itemTransformer="getData" showIf="isParent"/>
          <item name="DataFileOut" itemTransformer="getData" showIf="isResult"/>
          <item
            name="epi_DataSummary"
            displayName="Results"
            showIf="isResult"
            viewClassName="SyncroSim.Core.Forms.MultiRowDataFeedView"
            viewClassAssembly="SyncroSim.Core.Forms"
            filterTransformer="getData"
            itemTransformer="getData"/>
        </group>
        <group name="Projection" appendTo="Pypmca">
          <item name="FittingParams" itemTransformer="runIterations" showIf="isParent"/>
          <item name="ParameterValues" itemTransformer="runIterations" showIf="isParent"/>
          <item name="PopulationSelectionTable" itemTransformer="runIterations" showIf="isParent"/>
          <item name="FitVariables" itemTransformer="runIterations" showIf="isResult"/>
          <item name="ModelFile" itemTransformer="runIterations" showIf="isParent"/>
          <item name="CrosswalkFile" itemTransformer="runIterations" showIf="isParent"/>
          <item name="ModelChoices" itemTransformer="runIterations" showIf="isParent"/>
          <item
            name="epi_DataSummary"
            displayName="Data"
            showIf="isResult"
            viewClassName="SyncroSim.Core.Forms.MultiRowDataFeedView"
            viewClassAssembly="SyncroSim.Core.Forms"
            filterTransformer="runIterations"
            itemTransformer="runIterations"/>
        </group>
      </group>
    </layout>
  </layouts>
</package>

<!-- <group name="Inputs" displayName="Inputs" appendTo="KarlenModel">
</group> -->
<!-- <group name="Outputs" displayName="Outputs" appendTo="KarlenModel">
  <item name="ModelsAvailable" itemTransformer="getRepos" showIf="isResult"/>
  <item name="FitVariables" itemTransformer="runIterations" showIf="isEither"/>
  <item name="PopulationSelectionTable" itemTransformer="getParameters" showIf="isResult"/>
</group> -->
<!-- <group name="Data" displayName="Repository Data" appendTo="KarlenModel">
  <item
    name="epi_DataSummary"
    displayName="Data"
    showIf="isResult"
    viewClassName="SyncroSim.Core.Forms.MultiRowDataFeedView"
    viewClassAssembly="SyncroSim.Core.Forms"
    filterTransformer="getData"
    itemTransformer="getData"/>
</group> -->
